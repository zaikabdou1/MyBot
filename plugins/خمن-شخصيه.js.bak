const fs = require('fs');
const path = require('path');

const ranksFile = path.join(__dirname, '../data/ranks.json');

function loadRanks() {
  try {
    if (!fs.existsSync(ranksFile)) fs.writeFileSync(ranksFile, '{}');
    return JSON.parse(fs.readFileSync(ranksFile));
  } catch {
    return {};
  }
}

function saveRanks(ranks) {
  fs.writeFileSync(ranksFile, JSON.stringify(ranks, null, 2));
}

module.exports = {
  command: 'Ø®Ù…Ù†',
  category: 'ØªØ±ÙÙŠÙ‡',
  description: 'Ù„Ø¹Ø¨Ø© ØªØ®Ù…ÙŠÙ† Ø§Ù„Ø´Ø®ØµÙŠÙ‡ Ù…Ù† Ø§Ù„Ø´Ø±Ø­ Ø§Ù„Ø®Ø§Øµ Ø¨Ù‡Ø§ ðŸ§ ',
  async execute(sock, m) {
    const chatId = m.key.remoteJid;

    const characters = [
      { name: "Ù†Ø§Ø±ÙˆØªÙˆ", hint: "Ù†ÙŠÙ†Ø¬Ø§ Ø´Ù‚ÙŠ ÙŠØ­Ø¨ Ø§Ù„Ø±Ø§Ù…Ù† ÙˆÙŠÙ…Ù„Ùƒ ÙˆØ­Ø´ Ø§Ù„ÙƒÙŠÙˆØ¨ÙŠ Ø¨Ø¯Ø§Ø®Ù„Ù‡." },
      { name: "Ø³Ø§Ø³ÙƒÙŠ", hint: "Ù…Ù† Ø¹Ø´ÙŠØ±Ø© Ø§Ù„Ø£ÙˆØªØ´ÙŠÙ‡Ø§ØŒ ÙŠØ³Ø¹Ù‰ Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù… ÙˆÙŠÙ…Ù„Ùƒ Ø§Ù„Ø´Ø§Ø±ÙŠÙ†ØºØ§Ù†." },
      { name: "Ø³Ø§ÙƒÙˆØ±Ø§", hint: "Ø§Ù„ÙØªØ§Ø© Ø§Ù„ÙˆØ­ÙŠØ¯Ø© ÙÙŠ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø³Ø§Ø¨Ø¹ØŒ Ù„Ø¯ÙŠÙ‡Ø§ Ù‚ÙˆØ© Ø®Ø§Ø±Ù‚Ø© Ø¨Ø¹Ø¯ ØªØ¯Ø±ÙŠØ¨ ØªØ³ÙˆÙ†Ø§Ø¯ÙŠ." },
      { name: "ÙƒØ§ÙƒØ§Ø´ÙŠ", hint: "Ø§Ù„Ù†ÙŠÙ†Ø¬Ø§ Ø§Ù„Ù…Ù†Ø³ÙˆØ®ØŒ ÙŠÙ…Ù„Ùƒ Ø´Ø§Ø±ÙŠÙ†ØºØ§Ù† ÙÙŠ Ø¹ÙŠÙ† ÙˆØ§Ø­Ø¯Ø© ÙˆÙŠØºØ·ÙŠ ÙˆØ¬Ù‡Ù‡ Ø¯Ø§Ø¦Ù…Ù‹Ø§." },
      { name: "Ø¥ÙŠØªØ§ØªØ´ÙŠ", hint: "Ù‚ØªÙ„ Ø¹Ø´ÙŠØ±ØªÙ‡ Ù…Ù† Ø£Ø¬Ù„ Ø§Ù„Ø³Ù„Ø§Ù…ØŒ ÙˆÙ‡Ùˆ Ø§Ù„Ø£Ø® Ø§Ù„Ø£ÙƒØ¨Ø± Ù„Ø³Ø§Ø³ÙƒÙŠ." },
      { name: "Ù„ÙŠÙØ§ÙŠ", hint: "Ù‚ØµÙŠØ±ØŒ Ù‡Ø§Ø¯Ø¦ØŒ ÙˆØ£Ù‚ÙˆÙ‰ Ø¬Ù†Ø¯ÙŠ Ø¨Ø´Ø±ÙŠ Ø¶Ø¯ Ø§Ù„Ø¹Ù…Ø§Ù„Ù‚Ø©." },
      { name: "Ø§ÙŠØ±ÙŠÙ†", hint: "ØµØ§Ø­Ø¨ Ø¹Ø¨Ø§Ø±Ø© 'Ø³Ø£Ù‚Ø¶ÙŠ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø¹Ù…Ø§Ù„Ù‚Ø©'ØŒ ÙŠØªØ­ÙˆÙ„ Ù„Ø¹Ù…Ù„Ø§Ù‚." },
      { name: "Ù…ÙŠÙƒØ§Ø³Ø§", hint: "ØªØ­Ù…ÙŠ Ø¥ÙŠØ±ÙŠÙ† Ø¯Ø§Ø¦Ù…Ù‹Ø§ØŒ Ù…Ù‚Ø§ØªÙ„Ø© Ù‚ÙˆÙŠØ© ÙˆØ¨Ø§Ø±Ø¯Ø© Ø§Ù„Ø£Ø¹ØµØ§Ø¨." },
      { name: "Ø§Ø±Ù…ÙŠÙ†", hint: "Ø°ÙƒÙŠ Ø¬Ø¯Ù‹Ø§ØŒ ØµØ¯ÙŠÙ‚ Ø¥ÙŠØ±ÙŠÙ† Ø§Ù„Ù…Ù‚Ø±Ø¨ØŒ Ù„Ø¯ÙŠÙ‡ Ù‚ÙˆØ© Ø§Ù„Ø¥Ù‚Ù†Ø§Ø¹." },
      { name: "Ø²ÙˆØ±Ùˆ", hint: "Ø³ÙŠØ§Ù Ø¨Ø«Ù„Ø§Ø« Ø³ÙŠÙˆÙØŒ ÙŠØ±ÙŠØ¯ Ø£Ù† ÙŠØµØ¨Ø­ Ø£Ù‚ÙˆÙ‰ Ø³ÙŠØ§Ù ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…." },
      { name: "Ù„ÙˆÙÙŠ", hint: "Ù‚Ø¨Ø¹Ø© Ø§Ù„Ù‚Ø´ØŒ ÙŠØ­Ù„Ù… Ø¨Ø£Ù† ÙŠØµØ¨Ø­ Ù…Ù„Ùƒ Ø§Ù„Ù‚Ø±Ø§ØµÙ†Ø©." },
      { name: "Ø³Ø§Ù†Ø¬ÙŠ", hint: "Ø§Ù„Ø·Ø¨Ø§Ø® Ø§Ù„ÙˆØ³ÙŠÙ…ØŒ ÙŠØ³ØªØ®Ø¯Ù… Ù‚Ø¯Ù…Ù‡ ÙÙŠ Ø§Ù„Ù‚ØªØ§Ù„ ÙˆÙŠØ­Ø¨ Ø§Ù„ÙØªÙŠØ§Øª." },
      { name: "Ù†Ø§Ù…ÙŠ", hint: "Ø±Ø³Ù… Ø§Ù„Ø®Ø±Ø§Ø¦Ø· ÙˆØ§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø·Ù‚Ø³ØŒ ØªØ­Ø¨ Ø§Ù„Ù…Ø§Ù„." },
      { name: "ØªØ´ÙˆØ¨Ø±", hint: "Ø±Ù†Ø© ØªØªØ­ÙˆÙ„ Ù„Ø¥Ù†Ø³Ø§Ù†ØŒ Ø·Ø¨ÙŠØ¨ Ø·Ø§Ù‚Ù… Ù‚Ø¨Ø¹Ø© Ø§Ù„Ù‚Ø´." },
      { name: "Ø±ÙˆØ¨ÙŠÙ†", hint: "ØªØ­Ø¨ Ø§Ù„ÙƒØªØ¨ØŒ ØªØ³ØªØ·ÙŠØ¹ Ø¥Ø®Ø±Ø§Ø¬ Ø£ÙŠØ¯ÙŠ Ù…Ù† Ø£ÙŠ Ù…ÙƒØ§Ù†." },
      { name: "ÙØ±Ø§Ù†ÙƒÙŠ", hint: "Ø¢Ù„ÙŠ ÙˆÙ…Ù‡Ù†Ø¯Ø³ Ø§Ù„Ø·Ø§Ù‚Ù…ØŒ ÙŠØ­Ø¨ Ø§Ù„ØµØ±Ø§Ø® 'Ø³ÙˆØ¨Ù‘Ø±!'" },
      { name: "Ø³Ø§ÙŠØªØ§Ù…Ø§", hint: "Ø£Ù‚ÙˆÙ‰ Ø¨Ø·Ù„ØŒ ÙŠÙ‡Ø²Ù… Ø£ÙŠ Ø´Ø®Øµ Ø¨Ø¶Ø±Ø¨Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·." },
      { name: "Ø¬ÙŠÙ†ÙˆØ³", hint: "Ø³Ø§ÙŠØ¨ÙˆØ±Øº ØªÙ„Ù…ÙŠØ° Ø³Ø§ÙŠØªØ§Ù…Ø§ØŒ ÙŠØ³Ø¹Ù‰ Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù…." },
      { name: "ØºÙˆÙƒÙˆ", hint: "Ù…Ø­Ø§Ø±Ø¨ Ø³Ø§ÙŠØ§Ù† ÙŠØ­Ø¨ Ø§Ù„Ù‚ØªØ§Ù„ ÙˆØ§Ù„Ø·Ø¹Ø§Ù…ØŒ ÙŠØªØ­ÙˆÙ„ Ù„Ø³ÙˆØ¨Ø± Ø³Ø§ÙŠØ§Ù†." },
      { name: "ÙÙŠØ¬ÙŠØªØ§", hint: "Ø£Ù…ÙŠØ± Ø§Ù„Ø³Ø§ÙŠØ§Ù†ØŒ ÙØ®ÙˆØ± Ø¬Ø¯Ù‹Ø§ Ø¨Ù†ÙØ³Ù‡." },
      { name: "ØºÙˆÙ‡Ø§Ù†", hint: "Ø§Ø¨Ù† ØºÙˆÙƒÙˆØŒ Ù‡Ø§Ø¯Ø¦ ÙˆÙ‚ÙˆÙŠ Ø¹Ù†Ø¯Ù…Ø§ ÙŠØºØ¶Ø¨." },
      { name: "ÙƒÙŠÙ„ÙˆØ§", hint: "Ù…Ù† Ø¹Ø§Ø¦Ù„Ø© Ù‚ØªÙ„Ø©ØŒ Ø³Ø±ÙŠØ¹ ÙˆØ°ÙƒÙŠ ÙˆÙŠØ­Ø¨ ØºÙˆÙ†." },
      { name: "ØºÙˆÙ†", hint: "ØµØ¨ÙŠ ÙŠØ¨Ø­Ø« Ø¹Ù† ÙˆØ§Ù„Ø¯Ù‡ØŒ ÙŠÙ…ØªÙ„Ùƒ Ù‚Ù„Ø¨ Ù†Ù‚ÙŠ ÙˆÙ‚ÙˆØ© Ù…Ø°Ù‡Ù„Ø©." },
      { name: "Ù‡ÙŠØ³ÙˆÙƒØ§", hint: "ØºØ§Ù…Ø¶ ÙˆÙ…Ø®ÙŠÙØŒ ÙŠØ­Ø¨ Ø§Ù„Ù‚ØªØ§Ù„ ÙˆØ§Ù„Ø£Ø´Ø®Ø§Øµ Ø§Ù„Ø£Ù‚ÙˆÙŠØ§Ø¡." },
      { name: "Ù†Ø§ØªØ³Ùˆ", hint: "Ø³Ø§Ø­Ø± Ø§Ù„ØªÙ†ÙŠÙ† Ø§Ù„Ù†Ø§Ø±ÙŠ Ù…Ù† Ù†Ù‚Ø§Ø¨Ø© ÙÙŠØ±ÙŠ ØªÙŠÙ„ØŒ ÙŠØ­Ø¨ Ø§Ù„Ù‚ØªØ§Ù„." },
      { name: "Ù„ÙˆØ³ÙŠ", hint: "Ù…Ø³ØªØ¯Ø¹ÙŠØ© Ø£Ø±ÙˆØ§Ø­ØŒ ØªØ­Ø¨ Ø§Ù„ÙƒØªØ§Ø¨Ø©ØŒ ÙˆØµØ¯ÙŠÙ‚Ø© Ù†Ø§ØªØ³Ùˆ." },
      { name: "Ø¬Ø±Ø§ÙŠ", hint: "Ø³Ø§Ø­Ø± Ø¬Ù„ÙŠØ¯ ÙŠØ­Ø¨ Ø®Ù„Ø¹ Ù…Ù„Ø§Ø¨Ø³Ù‡ØŒ Ù…Ù†Ø§ÙØ³ Ù†Ø§ØªØ³Ùˆ." },
      { name: "Ø§ÙŠØ±Ø²Ø§", hint: "Ø³Ø§Ø­Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø¹Ø§ØªØŒ Ù‚ÙˆÙŠØ© Ø¬Ø¯Ù‹Ø§ ÙˆÙ…Ø®ÙŠÙØ© Ø¹Ù†Ø¯Ù…Ø§ ØªØºØ¶Ø¨." },
      { name: "ØªØ§Ù†Ø¬ÙŠØ±Ùˆ", hint: "ØµÙŠØ§Ø¯ Ø´ÙŠØ§Ø·ÙŠÙ† Ø·ÙŠØ¨ØŒ ÙŠØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø£Ø®ØªÙ‡ Ù„Ø·Ø¨ÙŠØ¹ØªÙ‡Ø§." },
      { name: "Ù†ÙŠØ²ÙˆÙƒÙˆ", hint: "Ø£Ø®ØªÙ‡ ØªØ­ÙˆÙ„Øª Ù„Ø´ÙŠØ·Ø§Ù† Ù„ÙƒÙ†Ù‡Ø§ Ù„Ø§ ØªØ¤Ø°ÙŠ Ø§Ù„Ø¨Ø´Ø±." },
      { name: "Ø§ÙŠÙ†ÙˆØ³ÙƒÙŠ", hint: "ÙŠØ±ØªØ¯ÙŠ Ø±Ø£Ø³ Ø®Ù†Ø²ÙŠØ±ØŒ Ù…Ù‚Ø§ØªÙ„ Ø¹Ù†ÙŠÙ ÙˆØ³Ø±ÙŠØ¹." },
      { name: "Ø²ÙŠÙ†ÙŠØªØ³Ùˆ", hint: "Ø¬Ø¨Ø§Ù† Ù„ÙƒÙ†Ù‡ ÙŠØµØ¨Ø­ Ù‚ÙˆÙŠÙ‹Ø§ Ø¬Ø¯Ù‹Ø§ Ø¹Ù†Ø¯Ù…Ø§ ÙŠØºÙ…Ù‰ Ø¹Ù„ÙŠÙ‡." },
      { name: "Ø§ÙˆØ¨ÙŠØªÙˆ", hint: "ÙƒØ§Ù† ØµØ¯ÙŠÙ‚ ÙƒØ§ÙƒØ§Ø´ÙŠØŒ Ø£ØµØ¨Ø­ Ø´Ø±ÙŠØ±Ù‹Ø§ Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø®ÙŠØ§Ù†Ø©." },
      { name: "Ù…Ø§Ø¯Ø§Ø±Ø§", hint: "Ù…Ù† Ø£Ù‚ÙˆÙ‰ Ø´Ø®ØµÙŠØ§Øª Ø§Ù„Ø£ÙˆØªØ´ÙŠÙ‡Ø§ØŒ ÙŠØ±ÙŠØ¯ Ø§Ù„Ø³Ù„Ø§Ù… Ø¨Ø·Ø±ÙŠÙ‚ØªÙ‡ Ø§Ù„Ø®Ø§ØµØ©." },
      { name: "Ø¨ÙˆØ±ÙˆØªÙˆ", hint: "Ø§Ø¨Ù† Ù†Ø§Ø±ÙˆØªÙˆØŒ Ù„Ø§ ÙŠØ­Ø¨ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨ÙˆØ§Ù„Ø¯Ù‡." },
      { name: "ÙƒÙˆÙ†ÙˆÙ‡Ù…Ø§Ø±Ùˆ", hint: "ØªÙ„Ù…ÙŠØ° Ø³Ø§Ø¨Ù‚ Ù„Ù†Ø§Ø±ÙˆØªÙˆØŒ Ø£ØµØ¨Ø­ Ø¬ÙˆÙ†ÙŠÙ† Ù‚ÙˆÙŠ." },
      { name: "Ù†ÙŠØ¬ÙŠ", hint: "Ù…Ù† Ø¹Ø´ÙŠØ±Ø© Ø§Ù„Ù‡ÙŠÙˆØºØ§ØŒ ÙŠÙ…Ù„Ùƒ Ø§Ù„Ø¨ÙŠØ§ÙƒÙˆØºØ§Ù†." },
      { name: "Ù‡ÙŠÙ†Ø§ØªØ§", hint: "Ø®Ø¬ÙˆÙ„Ø©ØŒ ØªØ­Ø¨ Ù†Ø§Ø±ÙˆØªÙˆØŒ ÙˆØªÙ‚Ø§ØªÙ„ Ø¨Ø£Ø³Ù„ÙˆØ¨ Ù„Ø·ÙŠÙ." },
      { name: "Ø±ÙˆÙƒ Ù„ÙŠ", hint: "Ù„Ø§ ÙŠØ³ØªØ·ÙŠØ¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¬ØªØ³ÙˆØŒ Ù„ÙƒÙ† ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØªØ§ÙŠØ¬ØªØ³Ùˆ ÙÙ‚Ø·." },
      { name: "ØºØ§Ø±Ø§", hint: "ÙƒØ§Ù† Ø´Ø±ÙŠØ±Ù‹Ø§ØŒ ÙŠØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø±Ù…Ù„ØŒ Ø£ØµØ¨Ø­ ÙƒØ§Ø²ÙŠÙƒØ§Ø¬ÙŠ." },
      { name: "Ø´ÙŠÙ†ÙˆØ¨Ùˆ", hint: "ØµÙŠØ§Ø¯Ø© Ø´ÙŠØ§Ø·ÙŠÙ†ØŒ ØµØºÙŠØ±Ø© Ø§Ù„Ø­Ø¬Ù… ÙˆØªØ³ØªØ®Ø¯Ù… Ø§Ù„Ø³Ù…." },
      { name: "Ø±ÙˆÙ†Ø§Ù„Ø¯", hint: "Ù…Ø­Ù‚Ù‚ ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ù…ÙˆØªØŒ ÙŠÙ…ØªÙ„Ùƒ Ù…Ø°ÙƒØ±Ø© Ø§Ù„Ù…ÙˆØª." },
      { name: "Ù„Ø§ÙŠØª", hint: "ÙŠØ³ØªØ®Ø¯Ù… Ù…Ø°ÙƒØ±Ø© Ø§Ù„Ù…ÙˆØª Ù„ØªØ·Ù‡ÙŠØ± Ø§Ù„Ø¹Ø§Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¬Ø±Ù…ÙŠÙ†." },
      { name: "Ø¥Ù„", hint: "Ù…Ø­Ù‚Ù‚ Ø¹Ø¨Ù‚Ø±ÙŠØŒ ÙŠØ­Ø§ÙˆÙ„ ÙƒØ´Ù ÙƒÙŠØ±Ø§." },
      { name: "Ø±ÙŠÙˆÙƒ", hint: "Ø´ÙŠÙ†ÙŠØºØ§Ù…ÙŠ ÙŠØ­Ø¨ Ø§Ù„ØªÙØ§Ø­ØŒ Ø£Ø¹Ø·Ù‰ Ø§Ù„Ù…Ø°ÙƒØ±Ø© Ù„Ù„Ø§ÙŠØª." }
    ];

    const random = characters[Math.floor(Math.random() * characters.length)];
    const correctAnswer = random.name.trim().toLowerCase();

    await sock.sendMessage(chatId, {
text: `*ðŸ§  Ø®Ù…Ù† Ø§Ù„Ø´Ø®ØµÙŠØ© Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„ÙˆØµÙ:*\n\n*Ø±Ù†Ø© ØªØªØ­ÙˆÙ„ Ù„Ø¥Ù†Ø³Ø§Ù†ØŒ Ø·Ø¨ÙŠØ¨ Ø·Ø§Ù‚Ù… Ù‚Ø¨Ø¹Ø© Ø§Ù„Ù‚Ø´.*\n\n> â³ Ù„Ø¯ÙŠÙƒ 30 Ø«Ø§Ù†ÙŠØ© ÙÙ‚Ø·!`
    });

    const handler = async ({ messages }) => {
      for (const msg of messages) {
        if (msg.key.remoteJid !== chatId) continue;

        const text =
          msg.message?.conversation ||
          msg.message?.extendedTextMessage?.text ||
          '';

        if (text.trim().toLowerCase() === correctAnswer) {
          clearTimeout(timeout);
          sock.ev.off('messages.upsert', handler);

          const sender = msg.key.participant;
          const ranks = loadRanks();
          ranks[sender] = (ranks[sender] || 0) + 3000;
          saveRanks(ranks);

          await sock.sendMessage(chatId, {
            text: `âœ… ØµØ­ÙŠØ­! Ø§Ù„Ø´Ø®ØµÙŠØ© Ù‡ÙŠ *${random.name}*.\nðŸ† Ø§Ù„ÙØ§Ø¦Ø²: @${sender.split('@')[0]}\nðŸ“Š Ù†Ù‚Ø§Ø·Ùƒ: ${ranks[sender]}`,
            mentions: [sender]
          });

          break;
        }
      }
    };

    sock.ev.on('messages.upsert', handler);

    const timeout = setTimeout(() => {
      sock.ev.off('messages.upsert', handler);
      sock.sendMessage(chatId, {
        text: `âŒ› Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!\nØ§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© ÙƒØ§Ù†Øª: *${random.name}*`
      });
    }, 30000);
  }
};