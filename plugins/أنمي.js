const fs = require('fs');
const path = require('path');

const ranksFile = path.join(__dirname, '../data/ranks.json');

function loadRanks() {
  try {
    if (!fs.existsSync(ranksFile)) fs.writeFileSync(ranksFile, '{}');
    return JSON.parse(fs.readFileSync(ranksFile));
  } catch {
    return {};
  }
}

function saveRanks(ranks) {
  fs.writeFileSync(ranksFile, JSON.stringify(ranks, null, 2));
}

const animeQuestions = [
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ù‚Ø§Ø¦Ø¯ Ù‚Ø±Ø§ØµÙ†Ø© Ù‚Ø¨Ø¹Ø© Ø§Ù„Ù‚Ø´ØŸ", answer: "Ù„ÙˆÙÙŠ" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø© ÙÙŠ Ø£Ù†Ù…ÙŠ Sailor MoonØŸ", answer: "Ù„ÙˆÙ†Ø§" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ ÙˆØ§Ù„Ø¯ ØºÙˆÙƒÙˆØŸ", answer: "Ø¨Ø§Ø±Ø¯ÙˆÙƒ" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… Ø§Ù„Ø´ÙŠÙ†ÙŠØºØ§Ù…ÙŠ ÙÙŠ Ø¯ÙŠØ« Ù†ÙˆØªØŸ", answer: "Ø±ÙŠÙˆÙƒ" },
  { question: "â“ ÙƒÙ… Ø¹Ø¯Ø¯ ÙƒØ±Ø§Øª Ø§Ù„ØªÙ†ÙŠÙ† ÙÙŠ Ø¯Ø±Ø§ØºÙˆÙ† Ø¨ÙˆÙ„ØŸ", answer: "7" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ù‚Ø§Ø¦Ø¯ Ù‚Ø±Ø§ØµÙ†Ø© Ù‚Ø¨Ø¹Ø© Ø§Ù„Ù‚Ø´ØŸ", answer: "Ù„ÙˆÙÙŠ" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø© ÙÙŠ Ø£Ù†Ù…ÙŠ Sailor MoonØŸ", answer: "Ù„ÙˆÙ†Ø§" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ ÙˆØ§Ù„Ø¯ ØºÙˆÙƒÙˆØŸ", answer: "Ø¨Ø§Ø±Ø¯ÙˆÙƒ" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… Ø§Ù„Ø´ÙŠÙ†ÙŠØºØ§Ù…ÙŠ ÙÙŠ Ø¯ÙŠØ« Ù†ÙˆØªØŸ", answer: "Ø±ÙŠÙˆÙƒ" },
  { question: "â“ ÙƒÙ… Ø¹Ø¯Ø¯ ÙƒØ±Ø§Øª Ø§Ù„ØªÙ†ÙŠÙ† ÙÙŠ Ø¯Ø±Ø§ØºÙˆÙ† Ø¨ÙˆÙ„ØŸ", answer: "7" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ø®ØµÙ… Ù†Ø§Ø±ÙˆØªÙˆ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØŸ", answer: "Ø³Ø§Ø³ÙƒÙŠ" },
  { question: "â“ Ù…Ù† Ø§Ù„Ø°ÙŠ ÙƒØªØ¨ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø´Ø®Ø§Øµ ÙÙŠ Ø¯ÙŠØ« Ù†ÙˆØªØŸ", answer: "Ù„Ø§ÙŠØª" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… Ø£Ø® Ø¥ÙŠØªØ§ØªØ´ÙŠØŸ", answer: "Ø³Ø§Ø³ÙƒÙŠ" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ù‡Ø§ÙˆÙƒ Ø¢ÙŠØ² ÙÙŠ ÙˆÙ† Ø¨ÙŠØ³ØŸ", answer: "Ù…ÙŠÙ‡ÙˆÙƒ" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… Ø§Ù„ÙƒÙŠØ§Ù† Ø§Ù„Ø°ÙŠ ÙŠØ³Ø§Ø¹Ø¯ Ø¥ÙŠÙ†ÙˆÙŠØ´Ø§ØŸ", answer: "ÙƒÙŠÙƒÙŠÙˆ" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… ØµØ¯ÙŠÙ‚ ØºÙˆÙ† Ø§Ù„Ù…Ù‚Ø±Ø¨ØŸ", answer: "ÙƒÙŠÙ„ÙˆØ§" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù„Ù†Ø§Ø±ÙˆØªÙˆØŸ", answer: "Ø±Ø§Ø³ÙŠÙ†ØºØ§Ù†" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… Ø§Ù„Ø£Ù†Ù…ÙŠ Ø§Ù„Ø°ÙŠ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø´Ø®ØµÙŠØ© Ø¥Ø¯ÙˆØ§Ø±Ø¯ Ø¥Ù„Ø±ÙŠÙƒØŸ", answer: "ÙÙˆÙ„ Ù…ÙŠØªØ§Ù„ Ø£Ù„ÙƒÙŠÙ…Ø³Øª" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ù…Ù„Ùƒ Ø§Ù„Ù‚Ø±Ø§ØµÙ†Ø©ØŸ", answer: "ØºÙˆÙ„ Ø¯ÙŠ Ø±ÙˆØ¬Ø±" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… Ø³ÙŠÙ Ø²ÙˆØ±Ùˆ Ø§Ù„Ø«Ø§Ù„Ø«ØŸ", answer: "ÙˆØ§Ø¯Ùˆ Ø¥ÙŠØªØ´ÙŠ Ù…ÙˆÙ†Ø¬ÙŠ" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ø®ØµÙ… Ù„ÙˆÙÙŠ ÙÙŠ Ø£Ø±Ø®Ø¨ÙŠÙ„ Ø´Ø§Ø¨ÙˆÙ†Ø¯ÙŠØŸ", answer: "ÙƒÙŠØ²Ø§Ø±Ùˆ" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… ÙØªØ§Ø© Ø§Ù„ØªÙŠ ØªÙ…ØªÙ„Ùƒ Ù‚ÙˆØ© ØªÙŠØªØ§Ù† Ø§Ù„Ù…Ø¤Ù†Ø«ØŸ", answer: "Ø¢Ù†ÙŠ" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ø§Ù„Ø°ÙŠ Ù‚ØªÙ„ Ø¥ÙŠØªØ§ØªØ´ÙŠØŸ", answer: "Ø³Ø§Ø³ÙƒÙŠ" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ø£Ø¹Ø¸Ù… Ù…Ø­Ù‚Ù‚ ÙÙŠ Ø¯ÙŠØ« Ù†ÙˆØªØŸ", answer: "L" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ ØµØ§Ø­Ø¨ Ù‚Ø¨Ø¹Ø© Ø§Ù„Ù‚Ø´ Ù‚Ø¨Ù„ Ù„ÙˆÙÙŠØŸ", answer: "Ø´Ø§Ù†ÙƒØ³" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¸Ù…Ø© Ø§Ù„ØªÙŠ ÙŠÙ†ØªÙ…ÙŠ Ø¥Ù„ÙŠÙ‡Ø§ Ø¥ÙŠØªØ§ØªØ´ÙŠØŸ", answer: "Ø§Ù„Ø£ÙƒØ§ØªØ³ÙƒÙŠ" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ø®Ø§Øµ Ø¨Ù€ ØºÙˆÙ†ØŸ", answer: "ÙƒØ§ÙŠØªÙˆ" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ù…Ù„Ùƒ Ø§Ù„Ø¹Ù…Ø§Ù„Ù‚Ø©ØŸ", answer: "Ø²ÙŠÙƒ" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ø§Ù„Ù†ÙŠÙ†Ø¬Ø§ Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ Ø§Ù„Ø°ÙŠ Ø¯Ø±Ø¨ Ù†Ø§Ø±ÙˆØªÙˆØŸ", answer: "Ø¬ÙŠØ±Ø§ÙŠØ§" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… Ø£ÙˆÙ„ Ø¨ÙˆÙƒÙŠÙ…ÙˆÙ† ÙÙŠ Ø§Ù„Ø¨ÙˆÙƒÙŠØ¯ÙƒØ³ØŸ", answer: "Ø¨ÙˆÙ„Ø¨Ø§Ø³ÙˆØ±" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ ØµØ§Ø­Ø¨ Ù‚Ø¯Ø±Ø© ØºØ±ÙŠÙ…ÙˆØ§Ø± Ø§Ù„Ù†Ø¬Ù… Ø§Ù„Ø£Ø³ÙˆØ¯ØŸ", answer: "Ø£Ø³ØªØ§" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ù‚Ø§ØªÙ„ ÙˆØ§Ù„Ø¯ Ø¥ÙŠØ±ÙŠÙ†ØŸ", answer: "Ø²ÙŠÙƒ" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ù‚Ø§Ø¦Ø¯ ÙØ±Ù‚Ø© Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ ÙÙŠ Ù‡Ø¬ÙˆÙ… Ø§Ù„Ø¹Ù…Ø§Ù„Ù‚Ø©ØŸ", answer: "Ù„ÙŠÙØ§ÙŠ" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… Ø£Ø® Ù†Ø§Ø±ÙˆØªÙˆØŸ", answer: "Ù…Ø§ Ø¹Ù†Ø¯ÙˆØ´" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù„ÙŠ Ø£ÙƒÙ„ ÙØ§ÙƒÙ‡Ø© Ø§Ù„Ù…Ø·Ø§Ø·ØŸ", answer: "Ù„ÙˆÙÙŠ" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… Ø´Ø®ØµÙŠØ© Ù†Ø§Ø±ÙˆØªÙˆ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ", answer: "Ù†Ø§Ø±ÙˆØªÙˆ Ø£ÙˆØ²ÙˆÙ…Ø§ÙƒÙŠ" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ù…Ø­Ù‚Ù‚ ÙƒÙˆÙ†Ø§Ù† Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŸ", answer: "Ø³ÙŠÙ†Ø´ÙŠ ÙƒÙˆØ¯Ùˆ" },
  { question: "â“ Ù…Ù† Ù‡ÙŠ ÙØªØ§Ø© Ø§Ù„Ù‚Ù…Ø± ÙÙŠ Ø£Ù†Ù…ÙŠ Sailor MoonØŸ", answer: "Ø£ÙˆØ³Ø§ØºÙŠ" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ø§Ù„Ø®ØµÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„ØºÙˆÙ†ØŸ", answer: "Ù‡ÙŠØ³ÙˆÙƒØ§" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ù‚Ø§Ø¦Ø¯ ÙØ±Ù‚Ø© Ø¨Ù„Ø§Ùƒ Ø¨ÙˆÙ„Ø²ØŸ", answer: "ÙŠØ§Ù…ÙŠ" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ ÙˆØ§Ù„Ø¯ Ø¥ÙŠØ±ÙŠÙ†ØŸ", answer: "ØºØ±ÙŠØ´Ø§ ÙŠÙŠØºØ±" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… ØµØ¯ÙŠÙ‚Ø© Ù…ÙŠÙ„ÙŠÙˆØ¯Ø§Ø³ØŸ", answer: "Ø¥Ù„ÙŠØ²Ø§Ø¨ÙŠØ«" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ø§Ù„ÙƒØ§Ø¨ØªÙ† ÙÙŠ Ø¨Ù„ÙŠØªØ´ØŸ", answer: "Ø¥ÙŠØªØ´ÙŠØºÙˆ" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… Ø§Ù„Ù‚Ø· ÙÙŠ ÙÙŠØ±ÙŠ ØªÙŠÙ„ØŸ", answer: "Ù‡Ø§Ø¨ÙŠ" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… Ù…Ù†Ø¸Ù…Ø© Ø§Ù„Ù‚ØªÙ„Ø© ÙÙŠ Ù‡Ù†ØªØ± x Ù‡Ù†ØªØ±ØŸ", answer: "Ø§Ù„Ø¹Ù†Ø§ÙƒØ¨" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ø£Ø¹Ø¸Ù… Ø³Ø§Ø­Ø± ÙÙŠ Ø¨Ù„Ø§Ùƒ ÙƒÙ„ÙˆÙØ±ØŸ", answer: "Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø³Ø­Ø±ÙŠ" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… Ø§Ù„Ø­ÙŠÙˆØ§Ù† Ø§Ù„Ù„ÙŠ Ù…Ø¹ Ù†Ø§Ø±ÙˆØªÙˆØŸ", answer: "Ø§Ù„ÙƒÙŠÙˆØ¨ÙŠ" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… Ø§Ù„Ø¹Ø¯Ùˆ Ø§Ù„Ù„ÙŠ Ø¹Ù†Ø¯Ù‡ Ù‚Ø¯Ø±Ø© Ø§Ù„Ù†Ø³Ø® ÙÙŠ Ù†Ø§Ø±ÙˆØªÙˆØŸ", answer: "ÙƒØ§ÙƒØ§Ø´ÙŠ" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ù…Ø¤Ù„Ù Ù…Ø°ÙƒØ±Ø© Ø§Ù„Ù…ÙˆØªØŸ", answer: "ØªØ³ÙˆØ¬ÙˆÙ…ÙŠ Ø£ÙˆØ¨Ø§" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø°ÙŠ ÙŠØªØ¯Ø±Ø¨ ÙÙŠÙ‡ Ø£Ø¨Ø·Ø§Ù„ Boku no HeroØŸ", answer: "ÙŠÙˆ Ø§ÙŠ" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ø§Ù„Ø°ÙŠ ÙŠÙ…Ù„Ùƒ Ù‚Ø¯Ø±Ø© â€œÙˆØ§Ù† ÙÙˆØ± Ø£ÙˆÙ„â€ØŸ", answer: "Ø¯ÙŠÙƒÙˆ" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ù‚Ø§ØªÙ„ Ù†ÙŠØ²ÙˆÙƒÙˆØŸ", answer: "Ù…ÙˆØ²Ø§Ù†" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… Ø§Ù„Ù‚Ù…Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ ÙÙŠ Ø£Ù†Ù…ÙŠ Dr. StoneØŸ", answer: "Senku" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ø§Ù„Ø°ÙƒÙŠ ÙÙŠ Ø£Ù†Ù…ÙŠ ÙƒÙˆÙ†Ø§Ù†ØŸ", answer: "Ø³ÙŠÙ†Ø´ÙŠ" },
  { question: "â“ Ù…Ø§ Ø§Ø³Ù… Ø§Ù„Ø£Ù…ÙŠØ±Ø© ÙÙŠ Ø£Ù†Ù…ÙŠ ØªÙˆØªÙˆØ±ÙˆØŸ", answer: "Ù…Ø§ÙŠ" },
  { question: "â“ Ù…Ù† Ù‡Ùˆ Ù…Ø¤Ø³Ø³ Ø£Ù†Ù…ÙŠ Ù†Ø§Ø±ÙˆØªÙˆØŸ", answer: "Ù…Ø§Ø³Ø§Ø´ÙŠ ÙƒÙŠØ´ÙŠÙ…ÙˆØªÙˆ" },
];

module.exports = {
  category: 'ØªØ±ÙÙŠÙ‡',
  command: 'Ø§Ù†Ù…ÙŠ',
  async execute(sock, m) {
    const chatId = m.key.remoteJid;
    const random = animeQuestions[Math.floor(Math.random() * animeQuestions.length)];
    const correctAnswer = random.answer.trim().toLowerCase();

    await sock.sendMessage(chatId, {
      text: `ðŸŽŒ Ø³Ø¤Ø§Ù„ Ø£Ù†Ù…ÙŠ:\n\n${random.question}\n\nâ³ Ù„Ø¯ÙŠÙƒ 30 Ø«Ø§Ù†ÙŠØ© ÙÙ‚Ø· Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø©!`
    });

    const handler = async ({ messages }) => {
      for (const msg of messages) {
        if (msg.key.remoteJid !== chatId) continue;

        const text =
          msg.message?.conversation ||
          msg.message?.extendedTextMessage?.text ||
          '';

        if (text.trim().toLowerCase() === correctAnswer) {
          clearTimeout(timeout);
          sock.ev.off('messages.upsert', handler);

          const sender = msg.key.participant;
          const ranks = loadRanks();
          ranks[sender] = (ranks[sender] || 0) + 1;
          saveRanks(ranks);

          await sock.sendMessage(chatId, {
            text: `âœ… ØµØ­ÙŠØ­! Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù‡ÙŠ *${random.answer}*.\nðŸ† Ø§Ù„ÙØ§Ø¦Ø²: @${sender.split('@')[0]}\nðŸ“Š Ù†Ù‚Ø§Ø·Ùƒ: ${ranks[sender]}`,
            mentions: [sender]
          });

          break;
        }
      }
    };

    sock.ev.on('messages.upsert', handler);

    const timeout = setTimeout(() => {
      sock.ev.off('messages.upsert', handler);
      sock.sendMessage(chatId, {
        text: `âŒ› Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!\nØ§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© ÙƒØ§Ù†Øª: *${random.answer}*`
      });
    }, 30000);
  }
};